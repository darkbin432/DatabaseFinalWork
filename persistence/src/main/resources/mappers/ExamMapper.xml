<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xhtlwb.dbfinal.persistence.ExamDao">

    <insert id="insertInfo" parameterType="com.xhtlwb.dbfinal.model.Exam" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO exam (title, description, course_id, teacher_id, begin_time, end_time, created_time, updated_time, status)
        VALUES (#{title}, #{description}, #{courseId}, #{teacherId}, #{beginTime}, #{endTime}, now(), now(), status)
    </insert>

    <update id="updateInfo" parameterType="com.xhtlwb.dbfinal.model.Exam">
        UPDATE exam
        SET
        <if test="title!=null">
            title = #{title},
        </if>
        <if test="description!=null">
            description = #{description},
        </if>
        <if test="courseId!=null">
            course_id = #{courseId},
        </if>
        <if test="teacherId!=null">
            teacher_id = #{teacherId},
        </if>
        <if test="beginTime!=null">
            begin_time = #{beginTime},
        </if>
        <if test="endTime!=null">
            end_time = #{endTime},
        </if>
        updated_time = now()
        where id = #{id};
    </update>


    <update id="deleteInfo" parameterType="int">
        UPDATE exam
        SET status = 0
        WHERE id = #{id};
    </update>

    <select id="getOne" parameterType="int" resultType="com.xhtlwb.dbfinal.model.Exam">
        SELECT *
        FROM exam
        WHERE id = #{id} AND status = 1
    </select>

    <select id="getAllExam" parameterType="com.xhtlwb.dbfinal.model.param.ExamParam" resultType="com.xhtlwb.dbfinal.model.Exam">
        SELECT *
        FROM exam LEFT JOIN user_exam_relationship ON exam.id = user_exam_relationship.exam_id
        <where>
            exam.status = 1
            AND user_exam_relationship.status = 1
            AND user_exam_relationship.user_username = #{username}
            <if test="title!=null">
                AND exam.title LIKE "%"#{title}"%"
            </if>
            <if test="courseId!=null">
                AND exam.course_id = #{courseId}
            </if>
            <if test="teacherId!=null">
                AND exam.teacher_id = #{teacherId}
            </if>
        </where>
        ORDER BY exam.id DESC
        <if test="offset!=null and size!=null">
            LIMIT #{offset},#{size};
        </if>
    </select>
</mapper>